<!DOCTYPE html>
<head>
</head>
<body>
    <input type="file" id="datoteka">
    <canvas id="canvas" width="1000px" height="700px" style="background-color: #ddd">


    </canvas>
</body>

<script>
    var vsebina;
    var canvas = document.querySelector("#canvas");
    var context = canvas.getContext("2d");
    context.translate(canvas.width/2,canvas.height/2);

    let points = new Array(1);
    let index = 0;
    let triangles = new Array(1);
    let indexTriangles = 0;
    console.log(points);
    function readFile(event) {
        var file = event.target.files[0];
        var trikotniki;
        
       // console.log(points);
        if (file) {
            var reader = new FileReader();
            reader.onload = function(res) {
                vsebina = res.target.result.split("\n");
                getTocke(vsebina);
                
                getTrikotniki(vsebina);
                
                draw();
            }
            reader.readAsText(file);
        } else {
            alert("failed");
        }
    }

    document.getElementById("datoteka").addEventListener("change", readFile, false);


    function getTocke(content) {
        for (var i = 0; i < content.length; i++) {
            if (content[i][0] === 'v') {
                //We have a record of a point
                var tocke = content[i].split(" ");
                var x = parseFloat(tocke[1]);
                var y = parseFloat(tocke[2]);
                var z = parseFloat(tocke[3]);
                //console.log(points);
                var trenutneTocke = [x, y, z, 1];
                points[index] = trenutneTocke;
                index++;
                
            }
        }
    }

    function getTrikotniki(content) {
        for (var i = 0; i < content.length; i++) {
            if (content[i][0] === 'f') {
                // We have a record of a triangle edges
                var stranice = content[i].split(" ");
                var first = parseInt(stranice[1]);
                var second = parseInt(stranice[2]);
                var third = parseInt(stranice[3]);
                
                //console.log("STRANICE: %d %d %d\n", first, second, third);
                
                var trenutniTriangle = [first, second, third];
                triangles[indexTriangles] = trenutniTriangle;
                indexTriangles++;
            }
        }
    }

    // Function to draw shapes from points array and triangles array
    function draw() {
        // DRAW POINTS
        for (var i = 0; i < points.length; i++) {
            context.fillRect(points[i][0], points[i][1], 4, 4);
        }

        // DRAW TRIANGLES
        for (var i = 0; i < triangles.length; i++) {
            context.moveTo(points[triangles[i][0] - 1][0], points[triangles[i][0] - 1][1]);
            context.lineTo(points[triangles[i][1] - 1][0], points[triangles[i][1] - 1][1]);

            context.moveTo(points[triangles[i][1] - 1][0], points[triangles[i][1] - 1][1]);
            context.lineTo(points[triangles[i][2] - 1][0], points[triangles[i][2] - 1][1]);

            context.moveTo(points[triangles[i][2] - 1][0], points[triangles[i][2] - 1][1]);
            context.lineTo(points[triangles[i][0] - 1][0], points[triangles[i][0] - 1][1]);
            context.stroke();
        }
    }

</script>
