<!DOCTYPE html>
<head>
    <script src="gl-matrix.js"></script>
</head>
<body>
    <input type="file" id="datoteka">
    <canvas id="canvas" width="1200px" height="900px" style="background-color: #C85E63">


    </canvas>
</body>


<script>
    var vsebina;
    var canvas = document.querySelector("#canvas");
    var context = canvas.getContext("2d");
    let points = new Array(1);
    let index = 0;
    let triangles = new Array(1);
    let indexTriangles = 0;
    console.log(points);
    function readFile(event) {
        var file = event.target.files[0];
        var trikotniki;
        
       // console.log(points);
        if (file) {
            var reader = new FileReader();
            reader.onload = function(res) {
                vsebina = res.target.result.split("\n");
                getTocke(vsebina);
                
                getTrikotniki(vsebina);
                
                context.beginPath();
                console.log(triangles);
                console.log(points);

                document.addEventListener("keydown", event => {
                    
                    switch (event.keyCode) {
                        case 38:
                            // move up
                            context.clearRect(0, 0, canvas.width, canvas.height);
                            context.beginPath();
                            var mat4 = new Mat4();
                            console.log(mat4);
                            translate(0, -5, 0);
                            break;
                        case 40:
                            // move down
                            context.clearRect(0, 0, canvas.width, canvas.height);
                            context.beginPath();
                            translate(0, 5, 0);
                            break;
                        case 39:
                            // move right
                            context.clearRect(0, 0, canvas.width, canvas.height);
                            context.beginPath();
                            translate(5, 0, 0);
                            break;
                        case 37:
                            // move left
                            context.clearRect(0, 0, canvas.width, canvas.height);
                            context.beginPath();
                            translate(-5, 0, 0);
                            break;
                        default:
                            break;
                    }
                });
                
                
                draw();
            }
            reader.readAsText(file);
        } else {
            alert("failed");
        }
    }

    document.getElementById("datoteka").addEventListener("change", readFile, false);


    function getTocke(content) {
        for (var i = 0; i < content.length; i++) {
            if (content[i][0] === 'v') {
                //We have a record of a point
                var tocke = content[i].split(" ");
                var x = parseFloat(tocke[1]);
                var y = parseFloat(tocke[2]);
                var z = parseFloat(tocke[3]);
                //console.log(points);
                var trenutneTocke = [x, y, z, 1];
                points[index] = trenutneTocke;
                index++;
                
            }
        }
    }

    function getTrikotniki(content) {
        for (var i = 0; i < content.length; i++) {
            if (content[i][0] === 'f') {
                // We have a record of a triangle edges
                var stranice = content[i].split(" ");
                var first = parseInt(stranice[1]);
                var second = parseInt(stranice[2]);
                var third = parseInt(stranice[3]);
                
                //console.log("STRANICE: %d %d %d\n", first, second, third);
                
                var trenutniTriangle = [first, second, third];
                triangles[indexTriangles] = trenutniTriangle;
                indexTriangles++;
            }
        }
    }

    function translate(a, b, c) {
        var translationMatrix = 
            [
             [1, 0, 0, a],
             [0, 1, 0, b],
             [0, 0, 1, c],
             [0, 0, 0, 1]
            ];
        // TRANSPOSE MATRIX OF POINTS
        for (var k = 0; k < points.length; k++) {
            points[k][0] += a;
            points[k][1] += b;
            points[k][2] += c;
        }
        draw();
        return translationMatrix;
    }

    // Function to draw shapes from points array and triangles array
    function draw() {
        // FIRST CLEAR CANVAS
        
        // DRAW POINTS
        for (var i = 0; i < points.length; i++) {
            context.fillRect(points[i][0], points[i][1], 4, 4);
        }

        // DRAW TRIANGLES
        for (var i = 0; i < triangles.length; i++) {
            context.moveTo(points[triangles[i][0] - 1][0], points[triangles[i][0] - 1][1]);
            context.lineTo(points[triangles[i][1] - 1][0], points[triangles[i][1] - 1][1]);

            context.moveTo(points[triangles[i][1] - 1][0], points[triangles[i][1] - 1][1]);
            context.lineTo(points[triangles[i][2] - 1][0], points[triangles[i][2] - 1][1]);

            context.moveTo(points[triangles[i][2] - 1][0], points[triangles[i][2] - 1][1]);
            context.lineTo(points[triangles[i][0] - 1][0], points[triangles[i][0] - 1][1]);
            context.stroke();
        }
    }

</script>
